<div fxLayout="column">
    <md-card fxFlexAlign="center" style="width:92%; margin: 30px 0">
        <md-tab-group *ngIf="fakeModelSlides.data.length; else NoContent" [(selectedIndex)]="tabIndex" [dynamicHeight]="true" (selectChange)="modelChips.length=0">
            <md-tab [disabled]="isEditing && tabIndex != i" *ngFor="let slide of fakeModelSlides.data; let i=index">
                <ng-template md-tab-label>
                    <span>Slide {{i + 1}}</span>
                </ng-template>
                <div>
                    <h3>Title</h3>
                    <h4>{{(modelTitle || slide.attributes.title || notSpecifiedMessage) | uppercase}}</h4>
                </div>
                <div *ngIf="isTitleEditing">
                    <md-input-container dividerColor="accent">
                        <input mdInput placeholder="Edit slide Title" [(ngModel)]="modelTitle" >
                        <md-hint [style.color]="'#f44336'" align="end">Remember to be short and sweet!</md-hint>
                    </md-input-container>
                </div>
                <div class="action-btn-cont" fxLayout="row">
                    <button *ngIf="!isTitleEditing" (click)="onEdit(slide, 'TIT')" md-raised-button color="accent">EDIT</button>
                    <ng-container *ngIf="isTitleEditing">
                        <button (click)="onCancelEdit('TIT')" md-raised-button color="accent">CANCEL</button>
                        <button class="ok-btn-gap" (click)="onOk('TIT', slide)" md-raised-button color="warn">OK</button>
                    </ng-container>
                </div>
                <hr>
                <div>
                    <h3>Background Image</h3>
                    <p><i>For the best user experience natural <strong>image width must to be >= 1280px</strong> and <strong>image height >= 1024px</strong></i></p>
                    <img *ngIf="modelBgImg.modelUrl || slide.attributes.backgroundImage; else NotSpecified" style="max-width:500px" [src]="modelBgImg.modelUrl || slide.attributes.backgroundImage">
                </div>
                <div *ngIf="modelBgImg.modelUrl">
                    <h4>Select background slide image:</h4>
                    <md-tab-group [dynamicHeight]="true">
                        <md-tab *ngFor="let image of publicImagesFakeModel.data; index as i">
                            <ng-template md-tab-label>
                                <span>Image {{i + 1}}</span>
                                <img style="width:30px;position:relative;top:10px;left:20px" [src]="image.links.self">
                            </ng-template>
                            <div fxLayout="row">
                                <div>
                                    <img #slideImgRef (click)="onBackgroundImgClick(image, slideImgRef)" style="width:300px;cursor:pointer;transition:.7s" [src]="image.links.self">
                                </div>
                                <div style="margin-left:25%">
                                    <p><i>Natural image size:</i></p>
                                    <p>{{slideImgRef?.naturalWidth}} &#10006; {{slideImgRef?.naturalHeight}}</p>
                                </div>
                            </div>
                        </md-tab>
                    </md-tab-group>
                </div>
                <div class="action-btn-cont" fxLayout="row">
                    <button *ngIf="!modelBgImg.modelUrl" (click)="onEdit(slide, 'B_IMG')" md-raised-button color="accent">EDIT</button>
                    <ng-container *ngIf="modelBgImg.modelUrl">
                        <button (click)="onCancelEdit('B_IMG')" md-raised-button color="accent">CANCEL</button>
                        <button class="ok-btn-gap" (click)="onOk('B_IMG', slide)" md-raised-button color="warn">OK</button>
                    </ng-container>
                </div>
                <hr>
                <div>
                    <h3>Slide Description</h3>
                    <p>{{modelDesc || slide.attributes.description || notSpecifiedMessage}}</p>
                </div>
                <div *ngIf="isDescEditing">
                    <md-input-container style="width:50%" dividerColor="accent">
                        <textarea 
                        mdInput 
                        mdTextareaAutosize 
                        [mdAutosizeMinRows]="5"
                        placeholder="Slide description" 
                        [(ngModel)]="modelDesc"></textarea>
                    </md-input-container>
                </div>
                <div class="action-btn-cont" fxLayout="row">
                    <button *ngIf="!isDescEditing" (click)="onEdit(slide, 'DESC')" md-raised-button color="accent">EDIT</button>
                    <ng-container *ngIf="isDescEditing">
                        <button (click)="onCancelEdit('DESC')" md-raised-button color="accent">CANCEL</button>
                        <button class="ok-btn-gap" (click)="onOk('DESC', slide)" md-raised-button color="warn">OK</button>
                    </ng-container>
                </div>
                <hr>
                <div>
                    <h3>Tours</h3>
                    
                        <ng-container *ngFor="let chip of slide.attributes.chips; index as j">
                            <md-chip-list class="mat-chip-list-stacked">
                            <md-chip #chipRef
                            style="width:330px;display:block;margin:20px 0;cursor:pointer"
                            color="primary"
                            (click)="onChipClick(chipRef, chip, j)">
                                <div fxLayout="row" fxLayoutAlign="space-between">
                                    <div fxFlexAlign="center" class="chip-avatar" [style.backgroundImage]="'url('+ getAvatarImage(chip, j) +')'"></div>
                                    <p fxFlexAlign="center" style="padding:0 10px;font-weight:bold;text-align:center;width:154px">{{modelChips[j]?.item.destination || chip.destination}}</p>
                                    <div style="width:126px;height:26px" fxFlexAlign="center">
                                        <ng-container *ngFor="let star of 'Putin'.split(''); index as starIndex">
                                            <svg style="width:22px;height:22px" xmlns="http://www.w3.org/2000/svg">
                                                <path class="chip__st" transform="scale(.09)" [attr.fill]="starIndex + 1 > getChipStarCount(chip, j) ? 'rgb(148, 148, 146)' : '#F8D64E'" d="m48,234 73-226 73,226-192-140h238z"></path>
                                            </svg>
                                        </ng-container>
                                    </div>
                                </div>
                            </md-chip>
                            <!--<div *ngFor="let editChip of modelChips">-->
                                <div *ngIf="modelChips[j]">
                                    <div>
                                        <h4>1. Select avatar:</h4>
                                        <md-tab-group [dynamicHeight]="true">
                                            <md-tab *ngFor="let image of publicImagesFakeModel.data; index as i">
                                                <ng-template md-tab-label>
                                                    <span>Image {{i + 1}}</span>
                                                    <img style="width:30px;position:relative;top:10px;left:20px" [src]="image.links.self">
                                                </ng-template>
                                                <div fxLayout="row">
                                                    <div>
                                                        <img #imgRef (click)="onAvatarImageClick(j, image.links.self, imgRef)" style="width:100px;cursor:pointer;transition:.7s" [src]="image.links.self">
                                                    </div>
                                                    <div style="margin-left:25%">
                                                        <p><i>Natural image size:</i></p>
                                                        <p>{{imgRef?.naturalWidth}} &#10006; {{imgRef?.naturalHeight}}</p>
                                                    </div>
                                                </div>
                                            </md-tab>
                                        </md-tab-group>
                                    </div>
                                    <div>
                                        <h4>2. Edit destination of tour:</h4>
                                        <md-input-container dividerColor="accent">
                                            <input mdInput placeholder="Edit destination of tour" [(ngModel)]="modelChips[j]?.item.destination">
                                            <md-hint [style.color]="'#f44336'" align="end">Remember to be short and sweet!</md-hint>
                                        </md-input-container>
                                    </div>
                                    <div>
                                        <h4>3. Star rating of destination:</h4>
                                        <md-input-container dividerColor="accent">
                                            <input [style.width.px]="starCountRef.validationMessage.length * 7 || 30" #starCountRef mdInput type="number" min="0" max="5" [ngModel]="modelChips[j]?.item.starCount" (ngModelChange)="onStartCountChange($event, j)">
                                            <md-hint *ngIf="starCountRef.validationMessage" [style.color]="'#f44336'">{{starCountRef.validationMessage}}</md-hint>
                                        </md-input-container>
                                    </div>
                                    <div style="margin-top:20px">
                                        <button (click)="onEditChipCancel(chip, j)" md-raised-button color="accent">CANCEL</button>
                                        <button class="ok-btn-gap" md-raised-button color="warn" (click)="openDialog(deleteSubject(i, j), 'tour')">DELETE TOUR</button>
                                        <button class="ok-btn-gap" (click)="onOk('CHIP', chip, j)" md-raised-button color="warn">OK</button>
                                    </div>
                                    
                                </div>
                            <!--</div>-->
                            </md-chip-list>
                        </ng-container>
                    <div style="margin:30px 0" fxLayout="row">
                        <button md-raised-button color="primary" (click)="addNewTour(slide)">ADD NEW TOUR</button>
                    </div>
                </div>
                <hr>
                <div style="margin:30px 0" fxLayout="row">
                    <button md-raised-button color="warn" (click)="openDialog(deleteSubject(i), 'slide')">DELETE SLIDE</button>
                </div>
            </md-tab>
        </md-tab-group>
    </md-card>
    <div style="margin:30px 0" fxLayout="row" fxLayoutAlign="space-around">
        <button (click)="onAddNewSlide()" md-raised-button color="primary">ADD NEW SLIDE</button>
        <button *ngIf="fakeModelSlides.data.length" (click)="onViewSlides()" md-raised-button color="accent">VIEW SLIDES</button>
        <button *ngIf="isNeedSaveChanges(objectRecord, fakeModelSlides)" md-raised-button color="warn">SAVE CHANGES</button>
    </div>
</div>

<ng-template #NoContent>
    <div fxLayout="row" fxLayoutAlign="center center" style="height:300px;width:100%">
        <h1 style="color:rgba(0,0,0,.4)">No Slides here yet...</h1>
    </div>
</ng-template>
<ng-template #NotSpecified>
    <span>{{notSpecifiedMessage}}</span>
</ng-template>